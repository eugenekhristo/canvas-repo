<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Canvas</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        canvas {
            width: 100vw;
            height: 99vh;
        }
    </style>
</head>

<body>
    <canvas></canvas>
    <script>
        const canvas = document.querySelector('canvas')
        canvas.width = canvas.clientWidth
        canvas.height = canvas.clientHeight
        let canvasW = canvas.width
        let canvasH = canvas.height
        const ctx = canvas.getContext('2d')

        function getMaxCirclesAmount() {
            let ratio = canvasW * canvasH / 100000
            if (ratio > 7) return 1400
            else if (ratio > 5) return 1100
            else if (ratio > 3) return 800
            else if (ratio > 1) return 500
            else return 300
        }

        const maxR = 5
        const minR = 1
        const bloatedR = 30
        let maxCirclesAmount = getMaxCirclesAmount()
        

        const colors = [
            '#2C3E50',
            '#2C3E50',
            '#E74C3C',
            '#E74C3C',
            '#BECCF1',
            '#3498DB',
            '#2980B9'
        ]

        const mouse = {
            x: undefined,
            y: undefined
        }

        canvas.addEventListener('mousemove', e => {
            mouse.x = e.x
            mouse.y = e.y
        })

        window.addEventListener('resize', e => {
            canvas.width = canvas.clientWidth
            canvas.height = canvas.clientHeight
            canvasW = canvas.width
            canvasH = canvas.height
            maxCirclesAmount = getMaxCirclesAmount()
            // create brand new portion of circles
            initProcess()
            console.log(maxCirclesAmount)
        })

        function createCircle(x, y, r, dx, dy, color) {
            r = Math.random() * (maxR - minR) + minR
            let mainR = r
            x = (Math.random() * (canvasW - r * 2)) + r
            y = (Math.random() * (canvasH - r * 2)) + r
            dx = (Math.random() - 0.5) * 4
            dy = (Math.random() - 0.5) * 4
            color = colors[Math.floor(Math.random() * colors.length)]


            function draw() {
                ctx.fillStyle = color
                ctx.beginPath()
                ctx.arc(x, y, r, 0, Math.PI * 2)
                ctx.fill()
            }

            function move() {
                draw()
                x += dx
                y += dy
                if (x + r >= canvasW || x - r <= 0) dx *= -1
                if (y + r >= canvasH || y - r <= 0) dy *= -1

                if (mouse.x - x < 60 && x - mouse.x < 60 &&
                    mouse.y - y < 60 && y - mouse.y < 60) {
                    if (r < bloatedR) {
                        r += 5
                    }
                } else if (r > mainR) {
                    r -= 1
                    if (r < mainR) r = mainR
                }

            }

            return {
                move
            }
        }

        let circles = []
        // create a bunch of circles
        function initProcess() {
            circles = []
            for (let i = 0; i < maxCirclesAmount; i++) {
                circles.push(createCircle())
            }
        }
        // initial call
        initProcess();


        (function animate() {
            requestAnimationFrame(animate)
            ctx.clearRect(0, 0, canvasW, canvasH)
            for (const circle of circles) {
                circle.move()
            }
        })()
    </script>
</body>

</html>